{% extends 'base/base.html' %}

{% block title %}Recuperar Senha - Abertura de Contas{% endblock %}

{% block content %}
<div class="login-page">
    <div class="login-container-center">
        <div class="login-header">
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo do Sistema" class="logo">
            <h2 class="login-title">Recuperar Senha</h2>
            <p>Digite seu e-mail para recuperar a senha</p>
        </div>
        
        <div id="forgot-alert" class="alert alert-success hidden">
            <i class="fas fa-check-circle"></i>
            <span></span>
        </div>
        
        <form id="forgot-form" method="POST" action="{{ url_for('views.forgot_password') }}">
            <div class="form-group">
                <label for="forgot-email">
                    <i class="fas fa-envelope"></i> E-mail
                </label>
                <input
                    type="email"
                    id="forgot-email"
                    name="email"
                    required
                placeholder="Digite seu e-mail"
                value="{{ form_data.get('email', '') }}"
                {% if show_new_password %}readonly{% endif %}
            >
        </div>
        {% if show_new_password %}
            <input type="hidden" name="stage" value="reset">
            <div class="form-group">
                <label for="nova_senha">
                    <i class="fas fa-lock"></i> Nova Senha
                </label>
                <input
                    type="password"
                    id="nova_senha"
                    name="nova_senha"
                    required
                    placeholder="Digite a nova senha"
                    autocomplete="new-password"
                >
            </div>

            <div class="form-group">
                <label for="confirmar_senha">
                    <i class="fas fa-lock"></i> Confirmar Nova Senha
                </label>
                <input
                    type="password"
                    id="confirmar_senha"
                    name="confirmar_senha"
                    required
                    placeholder="Repita a nova senha"
                    autocomplete="new-password"
                >
            </div>
            
            <button type="submit" class="btn btn-success btn-full">
                <i class="fas fa-unlock-alt"></i>
                Redefinir Senha
            </button>
        {% else %}
            <input type="hidden" name="stage" value="verify">
            <button type="submit" class="btn btn-primary btn-full">
                <i class=""></i>
                Verificar E-mail
            </button>
        {% endif %}
    </form>
    
        <div class="login-options">
            <a href="{{ url_for('views.login') }}" class="login-link">
                <i class="fas fa-arrow-left"></i> Voltar ao Login
            </a>
        </div>
    
    </div>
</div>
{% endblock %}

{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    {% for category, message in messages %}
    {% if category in ['error', 'success', 'info', 'warning'] %}
    const msg{{ loop.index }} = {{ message|tojson }};
    const type{{ loop.index }} = {{ category|tojson }};
    if (window.showAlert) {
        window.showAlert(msg{{ loop.index }}, type{{ loop.index }});
    } else {
        alert(msg{{ loop.index }});
    }
    {% endif %}
    {% endfor %}
});
</script>
{% endif %}
{% endwith %}
